{% extends "base.html" %}

{% block title %}Owner Dashboard - Smart Food{% endblock %}

{% block content %}
<div class="container">
    <div class="dashboard-header">
        <h1>Restaurant Dashboard</h1>
        <p>Welcome, {{ current_user.name }} - {{ current_user.restaurant_name }}</p>
    </div>
    
    <div class="dashboard-tabs">
        <button class="tab-btn active" onclick="showTab('dishes')">My Dishes</button>
        <button class="tab-btn" onclick="showTab('orders')">Orders</button>
        <button class="tab-btn" onclick="showTab('add-dish')">Add New Dish</button>
    </div>
    
    <!-- Dishes Tab -->
    <div id="dishes-tab" class="tab-content active">
        <div class="section-header">
            <h2>My Dishes</h2>
        </div>
        
        <div class="dishes-grid">
            {% for dish in dishes %}
            <div class="dish-card">
                <img src="{{ url_for('static', filename='img/dishes/' + dish.image_path) }}" 
                     alt="{{ dish.name }}" class="dish-image">
                <div class="dish-info">
                    <div class="dish-header">
                        <h3>{{ dish.name }}</h3>
                        <span class="dish-type {{ 'veg' if dish.is_veg else 'non-veg' }}">
                            {{ 'ðŸŸ¢ Veg' if dish.is_veg else 'ðŸ”´ Non-Veg' }}
                        </span>
                    </div>
                    <p class="dish-description">{{ dish.description[:100] }}...</p>
                    <div class="dish-meta">
                        <span class="dish-price">â‚¹{{ "%.2f"|format(dish.price) }}</span>
                        <span class="stock-info">Stock: {{ dish.stock }}</span>
                    </div>
                    <div class="dish-actions">
                        <a href="{{ url_for('owner.edit_dish', dish_id=dish.id) }}" class="btn btn-secondary btn-small">Edit</a>
                        <form method="POST" action="{{ url_for('owner.delete_dish', dish_id=dish.id) }}" 
                              style="display: inline;" onsubmit="return confirm('Are you sure you want to delete this dish?')">
                            <button type="submit" class="btn btn-danger btn-small">Delete</button>
                        </form>
                    </div>
                </div>
            </div>
            {% else %}
            <div class="no-dishes">
                <p>You haven't added any dishes yet. <a href="#" onclick="showTab('add-dish')">Add your first dish</a></p>
            </div>
            {% endfor %}
        </div>
    </div>
    
    <!-- Orders Tab -->
    <div id="orders-tab" class="tab-content">
        <div class="section-header">
            <h2>Customer Orders</h2>
        </div>
        
        {% if orders_data %}
            <div class="orders-list">
                {% for order_id, order_data in orders_data.items() %}
                <div class="order-card">
                    <div class="order-header">
                        <h3>Order #{{ order_id }}</h3>
                        <span class="order-date">{{ order_data.order.created_at.strftime('%B %d, %Y at %I:%M %p') }}</span>
                        <span class="order-status status-{{ order_data.order.status }}">{{ order_data.order.status.title() }}</span>
                    </div>
                    
                    <div class="order-customer">
                        <p><strong>Customer:</strong> {{ order_data.order.customer.name }}</p>
                        <p><strong>Email:</strong> {{ order_data.order.customer.email }}</p>
                    </div>
                    
                    <div class="order-items">
                        <h4>Items:</h4>
                        {% for item in order_data['items'] %}
                        <div class="order-item">
                            <span class="item-name">{{ item.dish.name }}</span>
                            <span class="item-quantity">Qty: {{ item.quantity }}</span>
                            <span class="item-price">â‚¹{{ "%.2f"|format(item.price * item.quantity) }}</span>
                        </div>
                        {% endfor %}
                    </div>
                    
                    <div class="order-total">
                        <strong>Your Earnings: â‚¹{{ "%.2f"|format(order_data.total) }}</strong>
                    </div>
                </div>
                {% endfor %}
            </div>
        {% else %}
            <div class="no-orders">
                <p>No orders received yet.</p>
            </div>
        {% endif %}
    </div>
    
    <!-- Add Dish Tab -->
    <div id="add-dish-tab" class="tab-content">
        <div class="section-header">
            <h2>Add New Dish</h2>
        </div>
        
        <form method="POST" action="{{ url_for('owner.add_dish') }}" enctype="multipart/form-data" class="dish-form">
            <div class="form-row">
                <div class="form-group">
                    <label for="name">Dish Name:</label>
                    <input type="text" id="name" name="name" required class="form-input">
                </div>
                
                <div class="form-group">
                    <label for="price">Price (â‚¹):</label>
                    <input type="number" id="price" name="price" step="0.01" min="0" required class="form-input">
                </div>
            </div>
            
            <div class="form-row">
                <div class="form-group">
                    <label for="stock">Stock Quantity:</label>
                    <input type="number" id="stock" name="stock" min="0" required class="form-input">
                </div>
                
                <div class="form-group">
                    <label for="image">Dish Image:</label>
                    <input type="file" id="image" name="image" accept="image/*" class="form-input">
                </div>
            </div>
            
            <div class="form-group">
                <label for="description">Description:</label>
                <textarea id="description" name="description" required class="form-textarea" rows="4"></textarea>
            </div>
            
            <div class="form-group">
                <label class="checkbox-label">
                    <input type="checkbox" name="is_veg" checked>
                    <span class="checkmark"></span>
                    Vegetarian Dish
                </label>
            </div>
            
            <button type="submit" class="btn btn-primary">Add Dish</button>
        </form>
    </div>
</div>

<script>
function showTab(tabName) {
    // Hide all tab contents
    const tabContents = document.querySelectorAll('.tab-content');
    tabContents.forEach(tab => tab.classList.remove('active'));
    
    // Remove active class from all tab buttons
    const tabBtns = document.querySelectorAll('.tab-btn');
    tabBtns.forEach(btn => btn.classList.remove('active'));
    
    // Show selected tab content
    document.getElementById(tabName + '-tab').classList.add('active');
    
    // Add active class to clicked button
    event.target.classList.add('active');
}
</script>
{% endblock %}